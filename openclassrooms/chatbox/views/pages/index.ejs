<% include header %>

    <h1>Bienvenue sur cette chatbox exp√©rimentale</h1>
    <div class="ui main container">
        <div class="ui feed">
        </div>
        <div class="inp">
            <form class="ui form">
                <div class="field">
                    <label for="message">Message</label>
                    <textarea name="message" id="message"></textarea>
                </div>
                <button type="submit" id='send' class="ui blue labeled sumbit icon button">
                    <i class="icon edit"></i>Submit
                </button>
            </form>
        </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
    let feed = document.querySelector('.feed')
    let pseudo = prompt('Veuillez entrer un pseudonyme')
    let socket = io.connect('http://localhost:8080')
    socket.emit('newUser',pseudo)

    // Emits message when form sent
    document.querySelector('#send').addEventListener('click',()=>{
        e.preventDefault()
        let message = document.querySelector('#message').value
        document.querySelector('#message').value=''
        socket.emit('log',message)
    })
    // Receive message and add it to the feed
    socket.on('chat',(message,pseudo)=>{
        feed.appendChild(addFrag(message,pseudo))
    })

    function addFrag(message,pseudo){
        let docFrag = document.createDocumentFragment()
        let event = document.createElement('div')
        event.className = 'event'
        let content = document.createElement('div')
        content.className = 'content'
        let summary = document.createElement('div')
        summary.className='summary'
        let dat = document.createElement('div')
        dat.className = 'date'
        let extxt = document.createElement('div')
        extxt.className = 'extra text'
        tim = new Date()
        dat.innerHTML = tim
        summary.innerText=pseudo
        extxt.innerText = message
        summary.appendChild(dat)
        content.appendChild(summary)
        content.appendChild(extxt)
        event.appendChild(content)
        docFrag.appendChild(event)
        return docFrag
    }
    </script> 

<% include footer %>
